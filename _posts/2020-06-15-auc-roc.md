---
title: "AUC ROC"
date: 2020-06-03 5:00:00
---
In this tutorial, we will be learning about the ROC curve.

## Introduction

- Before going through this post, it is highly recommended that you should have a good understanding of what is **confusion matrix and it's related terms.** If you want to learn more about confusion matrix please go through my youtube video, [click here](https://www.youtube.com/watch?v=wmk2R8OF2ek)
- Most of the machine learning problems you solve from online courses are mostly introductory datasets which are balanced and have a guarantee of high accuracy with most classifiers. But doesn’t reflect how data looks in the “real world”.
- Most of the **"real world"** data is not balanced. so it is important to learn how to evaluate the performance of the model where your interest lies in identifying the **minority class**.
- If it is important to check or visualize the performance of the binary class classification problem, we use **AUC (Area Under The Curve) ROC (Receiver Operating Characteristics) curve**.

- In few problems, predicting probabilities is better than predicting the class itself.  
- Predicting the probabilities can help you to tune the threshold values to balance between 2 errors that model make.
    - **False Positives:** You predicted today will be a rainy day when there was no rain
    - **False Negatives:** You predicted today is not a rainy day when in fact there was rain today.
- So by tuning the threshold value you can change the behaviour of your model for the problem you are solving.
- Let's consider an example of wild animals prediction on Agri fields. Where we are more concerned with having low false negatives than low false positives. Because if we have more false negatives then we are not warning the farmers about the wild animals and their field will be damaged.

### Example

Let's use convolutional neural networks to detect animals in the frame and predict whether it is a wild animal or not. In the last layer, we will be using sigmoid as an activation function to predict the probability and predict the class(wild animal or not)

<img src="http://drive.google.com/uc?export=view&id=179E4wrpnvhbCfER2wjbRb93VkEYaUha8" width="300" height="300"/>

- If you notice the circled animals where the sheep is predicted as wild animal and lion & zebra are predicted as a domestic animals (There can be any reason like bad light, fog, etc.. for this output)

 - Now if we fit the sigmoid activation on the last layer the y-axis will become the probability of predicting the type of an animal based on logit values.

<img src="http://drive.google.com/uc?export=view&id=1KD8gsOxve6SjjqFJ4rAncKGyW2PdXgt_" width="300" height="300"/>

- In the end, we need to convert these probabilities into classifications. So we can set a threshold value to classify those prbobabilities. let's consider 0.5 as a threshold value and if probability >= threshold then it is classified as a wild animal or if the probability is < threshold then it will be classified as a domestic animal

<img src="http://drive.google.com/uc?export=view&id=1Hj69nrVnHsTOrU3QCKqKC7F_YKxx2dSy" width="300" height="300"/>

- Now let's evaluate the performance of the model with a threshold value of 0.5

<img src="http://drive.google.com/uc?export=view&id=1NSKysvkTkGmnM2VFZochcNuWCFxbIaBJ" width="300" height="300"/>

- If we see it classified all the animals correctly except 3 animals (sheep, zebra and lion)
- Where it classified sheep as a wild animal and lion & Zebra as a domestic animals.

Lets's see the confusion matrix and identify the error

- Let's first understand what is confusion matrix and how it looks

<img src="http://drive.google.com/uc?export=view&id=1XkXw1hCRvGib-D1bTNMfJ-y4he6PFpNb" width="300" height="300"/>

    True Positives(TP): It is a wild animal and our model predicted it as a wild animal
    False Positives(FP): It is a Domestic animal and our model predicted it as a wild animal
    True Negatives(TN): It is a Domestic animal and our model predicted it as Domestic animal
    False Negatives(FN): It is a Wild animal and our model predicted it as Domestic animal
- This is confusion matrix and let's replace those 4 values which we got from the model

<img src="http://drive.google.com/uc?export=view&id=1_QIm7A0yAUuB8JC699Zaca4zyWaHoEF8" width="300" height="300"/>

- This is how it looks after filling the values

- We can now evaluate the performance of the model when the threshold value is 0.5 by calculating sensitivity and specificity
    - **Sensitivity:** It gives the percentage value of animals which are classified as wild are wild.
    <img src="https://latex.codecogs.com/svg.latex?\Large&space;sensitivity = \frac{True positives}{True Positives + False Negativies}" title="\Large sensitivity=\frac{True positives}{True Positives + False Negativies}" />

    \begin{equation} sensitivity = \frac{True positives}{True Positives + False Negativies} \end{equation}
    \begin{equation} sensitivity = \frac{3}{3 + 2} \end{equation}
    \begin{equation} sensitivity = 0.6 \end{equation}
    - It says that 60% of wild animals were correctly classified
    - **Specificity:** It gives the percentage value of animals which are classified as domestic are actually domestic.
    \begin{equation} specificity = \frac{True Negatives}{True Negatives + False Positives} \end{equation}
    \begin{equation} specificity = \frac{3}{3 + 1} \end{equation}
    \begin{equation} specificity = 0.75 \end{equation}
    - It says that 75% of domestic animals were correctly classified


- As we discussed our model will make 2 mistakes **False Positives** and **False Negatives**.
    - If predicting positives is important for you, then we should choose a model which makes less False Negatives(Choosing a model with higher sensitivity(True positive rate))
    - If predicting negatives is important for you, then we should choose a model which makes less False Positives(Choosing a model with higher specificity (True positive rate))


- We can maximize or minimize the metric (sensitivity or specificity) by choosing the right threshold value.

-Let's try to choose different threshold values and see how our model will work.
    - let the threshold value be 0.05

<img src="http://drive.google.com/uc?export=view&id=1yozYmle6uSJGAEKbPWYqg8QXMEdkUVb_" width="300" height="300"/>

    Confusion matrix

<img src="http://drive.google.com/uc?export=view&id=17oPwdg_9f3jwVYec2dGS3DGYewLt5qPl" width="300" height="300"/>

    By Decreasing the threshold value
      False positives will be increased
      False Negatives will be decreased

    By lowering the threshold value we are giving more importance in predicting the wild animals as wild. It is important right we need to alert the farmers correctly, else they get into trouble. There is no issue even False positives are increased upto some number.

- Let's Increase the threshold value to 0.8.
<img src="http://drive.google.com/uc?export=view&id=1zATnB9cE7lkdst6L4H_Se3OQ4xM-Wkn8" width="300" height="300"/>

    Confusion matrix

<img src="http://drive.google.com/uc?export=view&id=1SJG7_lRyXcd0LWFRN4YnwcV8N9fDqNqs" width="300" height="300"/>

    By Increasing the threshold value
      False positives will be decreased
      False Negatives will be increased

    By increasing the threshold value we are giving more importance in predicting the domestic animals as domestic. There is no issue even False positives are increased in this case

You got some understanding right by varying the threshold value your result will get changed.

So which threshold value works best? It is hard to find which threshold value works better as we cannot go through every threshold value and check it's respective confusion matrix.


One way to solve this is by using **ROC(Receiver Operator Characteristic) Curve**

### ROC(Receiver Operator Characteristic curve

  - It is used to measure the performance of your classification model at different threshold values.
  - ROC Curve tells us about how good the model can distinguish between two classes.
  - It also helps us to find the best threshold value.
  - This plot is plotted with 2 parameters.
      - True Positive Rate
      - False Positive Rate

  - **True Positive Rate (TPR):** It is a synonym for recall/Sensitivity.
  \begin{equation} TPR = \frac{True positives}{True Positives + False Negativies} \end{equation}
  - **False Positive Rate (FPR):**
  \begin{equation} FPR = \frac{False positives}{False Positives + True Negativies} \end{equation}

  - False Positive Rate (FPR) can also be written as:
      \begin{equation} FPR = 1 - specifiity \end{equation}

      \begin{equation} specifiity = \frac{True Negatives}{True Negatives + False Positives} \end{equation}

  - ROC curve plots TPR vs. FPR at different classification thresholds. Lowering the classification threshold classifies more items as positive, thus increasing both False Positives and True Positives.


## Relation between Sensitivity, Specificity, FPR and Threshold.
  - Sensitivity and Specificity are inversely proportional to each other. If we increase Sensitivity, Specificity decreases and vice versa.
  - If we decrease the threshold value, we are concentrating on predicting wild animals, so it increases the sensitivity and decreases the specificity.
  - If we Increase the threshold value, we are concentrating on predicting domestic animals, so it increases the specificity and decreases the sensitivity.

  <img src="http://drive.google.com/uc?export=view&id=1c-GlyYjnAlbKzZwYt4cvBVd_rqtOV3YO" width="300" height="300"/>

  - If we increase TPR, FPR also increases and vice versa.

  <img src="http://drive.google.com/uc?export=view&id=1XMLE-h4MKMWCeAkkLFQNdUhEJDnfuubB" width="300" height="300"/>

### Let's create ROC curve from scratch

  - first let us consider a threshold value of 0.

  <img src="http://drive.google.com/uc?export=view&id=13De5Yx5Jabbybp5FDX7fl6Re_SxmX_T_" width="300" height="300"/>

    - Let's build confusion matrix

    <img src="http://drive.google.com/uc?export=view&id=1sTaPVoPMMg08j8S8ajI1mlv_Tgyw6wZJ" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{5}{5 + 0} \end{equation}
    \begin{equation} TPR = 1 \end{equation}
    \begin{equation} FPR = \frac{4}{4 + 0} \end{equation}
    \begin{equation} FPR = 1 \end{equation}
    - When we have threshold value as low(0) then we correctely classified all wild animals as wild and wrongly classified all domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1W6bLK8VDFpyGwoF6eSIjNA97qeNUOkMW" width="300" height="300"/>

    - If you see the graph and line from (0,0) to (1,1). Whatever the point on this line means that the proportion of correctly classified samples is equal to the proportion of incorrectly classified samples.

  - Let's increase the threshold value a bit to 0.1

  <img src="http://drive.google.com/uc?export=view&id=17e6NrdSXsXkmuC9FoDt2mQtn481rOB9G" width="300" height="300"/>

    - Let's build confusion matrix

  <img src="http://drive.google.com/uc?export=view&id=1vzSyOzx8ApGpKfjtqu7ykGcpLyL3T3fs" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{5}{5 + 0} \end{equation}
    \begin{equation} TPR = 1 \end{equation}
    \begin{equation} FPR = \frac{1}{1 + 3} \end{equation}
    \begin{equation} FPR = 0.25 \end{equation}
    - When we have threshold value as 0.1 then we correctely classified all wild animals as wild and wrongly classified 25% of domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1NTf7rC8EqgC4wZ7NNVhufHUjLglUCXmR" width="300" height="300"/>


    - The point (0.25,1). Where the proportion of correctly classified samples is greater than proportion of incorrectly classified samples.

  - Let's increase the threshold value a bit to 0.2

  <img src="http://drive.google.com/uc?export=view&id=1CGR2xnCjmmR1Zdp05pim8Cpi92lo2aL8" width="300" height="300"/>

    - Let's build confusion matrix

  <img src="http://drive.google.com/uc?export=view&id=1uttF_1Y32HEl0ymqXzm9C33djQsHH1zL" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{4}{4 + 1} \end{equation}
    \begin{equation} TPR = 0.8 \end{equation}
    \begin{equation} FPR = \frac{1}{1 + 3} \end{equation}
    \begin{equation} FPR = 0.25 \end{equation}
    - When we have threshold value as 0.2 then we correctely classified 80% of wild animals as wild and wrongly classified 25% of domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1-vXZNiq7j6ARwDABMsqMG3LTcZJqwNft" width="300" height="300"/>

    - The point (0.25,0.8). Where the proportion of correctly classified samples is greater than proportion of incorrectly classified samples.

  - Let's increase the threshold value a bit to 0.5

  <img src="http://drive.google.com/uc?export=view&id=1kchwXIm7zvJyYiMZ2aK3ySRN-2fyuyC0" width="300" height="300"/>

    - Let's build confusion matrix

  <img src="http://drive.google.com/uc?export=view&id=1yEOwInpy-U69UvLBdYBZn7TV_ev3INht" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{3}{3 + 2} \end{equation}
    \begin{equation} TPR = 0.6 \end{equation}
    \begin{equation} FPR = \frac{1}{1 + 3} \end{equation}
    \begin{equation} FPR = 0.25 \end{equation}
    - When we have threshold value as 0.2 then we correctely classified 60% of wild animals as wild and wrongly classified 25% of domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1FvE9Ik-hNji4pwuk75FVhX1418tNRnIl" width="300" height="300"/>

    - The point (0.25,0.6). Where the proportion of correctly classified samples is greater than proportion of incorrectly classified samples.

  - Let's increase the threshold value a bit to 0.8

  <img src="http://drive.google.com/uc?export=view&id=1tos-y57IxBz98qJHAdawh2kmUXi7hztE" width="300" height="300"/>

    - Let's build confusion matrix

  <img src="http://drive.google.com/uc?export=view&id=11VWx_anYJxqShy_sij__F4lSka1M-bD5" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{3}{3 + 2} \end{equation}
    \begin{equation} TPR = 0.6 \end{equation}
    \begin{equation} FPR = \frac{0}{0 + 4} \end{equation}
    \begin{equation} FPR = 0.0 \end{equation}
    - When we have threshold value as 0.2 then we correctely classified 60% of wild animals as wild and wrongly classified 0% of domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1bhuiB84KS9sFGLijlaINCh50dfXclnOv" width="300" height="300"/>

    - The point (0.0,0.6). Where the proportion of correctly classified samples is greater than proportion of incorrectly classified samples.

  - Let's increase the threshold value a bit to 0.9

  <img src="http://drive.google.com/uc?export=view&id=1j20BpTp2pks_Rd9OVIJnF3IVJWXNzAgV" width="300" height="300"/>

    - Let's build confusion matrix

  <img src="http://drive.google.com/uc?export=view&id=1RocA8ah5Xg7tcxW4i1KuNqg7dq9W5JXW" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{2}{2 + 3} \end{equation}
    \begin{equation} TPR = 0.4 \end{equation}
    \begin{equation} FPR = \frac{0}{0 + 4} \end{equation}
    \begin{equation} FPR = 0.0 \end{equation}
    - When we have threshold value as 0.2 then we correctely classified 40% of wild animals as wild and wrongly classified 0% of domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1SRb8k42gxFDQmQ2wJQ-x_GPakpWbs8QX" width="300" height="300"/>

    - The point (0.0,0.4). Where the proportion of correctly classified samples is greater than proportion of incorrectly classified samples.


  - Let's increase the threshold value a bit to 1.0

  <img src="http://drive.google.com/uc?export=view&id=1mOvgBxlvDFPcUUe2uQKkG6U_gVk6Cr5N" width="300" height="300"/>

    - Let's build confusion matrix

  <img src="http://drive.google.com/uc?export=view&id=1jKU5omxvmT4nvmvxnodB4DfLKeGatNDa" width="300" height="300"/>

    - calculate TPR and FPR
    \begin{equation} TPR = \frac{0}{0 + 5} \end{equation}
    \begin{equation} TPR = 0.0 \end{equation}
    \begin{equation} FPR = \frac{0}{0 + 4} \end{equation}
    \begin{equation} FPR = 0.0 \end{equation}
    - When we have threshold value as 0.2 then we correctely classified 0% of wild animals as wild and wrongly classified 0% of domestic animals as wild
    - **ROC graph**

  <img src="http://drive.google.com/uc?export=view&id=1L8CUWBUzi1IkPe8xNNgktcSN14YBRYNs" width="300" height="300"/>

    - The point (0.0,0.0). Where we have zero true positives and zero false positives


  - Let's draw the final ROC curve

  <img src="http://drive.google.com/uc?export=view&id=16gy4-_3CXA5vmz5BlAFL6i3Lzux0UzhY" width="300" height="300"/>

  - The ROC graph summarizes all of the confusion matrices that each threshold produced.
  - The best threshold value can be E (0.0, 0.6) i.e 0.8 (where we don't have any False positives)
  - And it mostly depends on how many False Positives you are willing to accept then you can choose the best threshold value
  - **In this problem let's say I can at least accept 25% False positives and 100% True positives. Then the best threshold value will be B (0.25,1) i.e 0.1**

### AUC (Area under the curve)

  - Let's learn about AUC
  - It represents degree or measure of separability.
  - It measures the entire two-dimensional area underneath the entire ROC curve.
  - It provides an aggregate measure of performance across all possible classification thresholds.
  - It also helps you to compare multiple models.
  - Higher the AUC, better the model is.

  - Let's see this with an example
  - We consider the ROC curve which we got from CNN model.

  <img src="http://drive.google.com/uc?export=view&id=1mAYDrYJ9Z1wnFWCDqBNRaGwxvf3sfzLD" width="300" height="300"/>

  - Let's think we also build a model with NN to and we got this ROC curve

  <img src="http://drive.google.com/uc?export=view&id=1vtWiMFhg7BkWa-7NbrWm47WMGLCrKQ3u" width="300" height="300"/>

  - Let's combine both into one, and see which model is best

  <img src="http://drive.google.com/uc?export=view&id=1wYtreAmRRn6nE-jgb0VqqjS-72lcGPD2" width="300" height="300"/>

  - From this, we can understand that CNN model works better than NN model because the AUC value of CNN is greater then AUC value of NN

## Reference

  I learned a lot of theoretical concepts ROC from this [excellent video](https://www.youtube.com/watch?v=xugjARegisk) by Josh Starmer and explained with my own example. You can also watch the video to understand it more clearly.


If you like it please give a star for <a href="https://github.com/udaykiranreddykondreddy/Code-for-learn-machinelearning" target="_blank">this</a> repository.

### Code

<a href="https://github.com/udaykondreddy/Code-for-learn-machinelearning/blob/master/math/statistics/mean_mode_median.ipynb"  class="btn btn-info" role="button" target="_blank"> <i class="fa fa-github fa-2x" aria-hidden="true"></i></a>
